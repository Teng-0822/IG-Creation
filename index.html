<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <title>TOOLS</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap');
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    html, body {
      height: 100%;
      overflow: hidden;
      touch-action: manipulation;
    }
    
    body {
      font-family: 'Rajdhani', sans-serif;
      background: linear-gradient(145deg, #0d0221 0%, #150634 30%, #1a0a2e 60%, #0f0318 100%);
      color: #fff;
      height: 100vh;
      height: 100dvh;
      display: flex;
      flex-direction: column;
    }

    /* Animated Background */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(ellipse at 20% 20%, rgba(255, 0, 128, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(0, 255, 255, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(128, 0, 255, 0.05) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }

    /* Header */
    .header {
      background: rgba(15, 5, 30, 0.95);
      border-bottom: 1px solid rgba(255, 0, 128, 0.3);
      padding: 6px 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      z-index: 10;
      box-shadow: 0 2px 20px rgba(255, 0, 128, 0.2);
    }

    .header::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, #ff0080, #00ffff, #ff0080, transparent);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .back-btn {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      background: linear-gradient(135deg, #ff0080, #7b2ff7);
      border: none;
      display: none;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 14px;
      color: #fff;
    }

    .back-btn.visible { display: flex; }

    .header-title {
      font-family: 'Orbitron', sans-serif;
      font-weight: 900;
      font-size: 14px;
      background: linear-gradient(90deg, #ff0080, #00ffff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 30px rgba(255, 0, 128, 0.5);
    }

    .header-profile {
      font-size: 10px;
      color: #00ffff;
      font-weight: 600;
    }

    .ip-box {
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(0, 255, 255, 0.3);
      border-radius: 6px;
      padding: 4px 8px;
      font-family: 'Orbitron', monospace;
      font-size: 9px;
      color: #888;
      min-width: 70px;
      text-align: center;
      transition: all 0.3s;
    }

    .ip-box.loading { border-color: #fff; color: #fff; }
    .ip-box.success { 
      border-color: #0f0; 
      color: #0f0; 
      box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
      background: rgba(0, 255, 0, 0.1);
    }

    .rotate-btn {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      background: linear-gradient(135deg, #00ffff, #0080ff);
      border: none;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }

    .rotate-btn.rotating { animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .header-right {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* Main Content */
    .main {
      flex: 1;
      overflow: hidden;
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
    }

    /* Views */
    .view {
      display: none;
      flex: 1;
      padding: 8px;
      overflow-y: auto;
    }

    .view.active {
      display: flex;
      flex-direction: column;
      animation: fadeIn 0.2s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Menu */
    .menu {
      display: flex;
      flex-direction: column;
      gap: 10px;
      justify-content: center;
      flex: 1;
    }

    .menu-item {
      background: linear-gradient(135deg, rgba(255, 0, 128, 0.15), rgba(128, 0, 255, 0.15));
      border: 1px solid rgba(255, 0, 128, 0.3);
      border-radius: 12px;
      padding: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 12px;
      transition: all 0.2s;
    }

    .menu-item:hover {
      transform: translateX(5px);
      border-color: #ff0080;
      box-shadow: 0 0 20px rgba(255, 0, 128, 0.3);
    }

    .menu-icon {
      width: 42px;
      height: 42px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .menu-icon.insta { background: linear-gradient(135deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); }
    .menu-icon.threads { background: #000; border: 2px solid #fff; }
    .menu-icon.daisy { background: linear-gradient(135deg, #00c853, #00e676); }

    .menu-text { flex: 1; }
    .menu-title { font-size: 15px; font-weight: 700; color: #fff; }
    .menu-sub { font-size: 10px; color: #888; }
    .menu-arrow { color: #ff0080; font-size: 16px; }

    /* Cards */
    .card {
      background: rgba(20, 10, 40, 0.6);
      border: 1px solid rgba(255, 0, 128, 0.2);
      border-radius: 10px;
      padding: 8px;
      margin-bottom: 6px;
    }

    .card-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 9px;
      color: #ff0080;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* Profile Grid */
    .profile-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 4px;
    }

    .field {
      background: rgba(0, 255, 255, 0.05);
      border: 1px solid rgba(0, 255, 255, 0.2);
      border-radius: 6px;
      padding: 4px 6px;
      text-align: center;
      min-width: 0;
    }

    .field label {
      display: block;
      font-size: 7px;
      color: #888;
      text-transform: uppercase;
    }

    .field span, .field input {
      font-size: 9px;
      font-weight: 700;
      color: #00ffff;
      cursor: pointer;
      display: block;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      background: transparent;
      border: none;
      width: 100%;
      text-align: center;
      outline: none;
    }

    .field.fade span {
      mask-image: linear-gradient(to right, #000 60%, transparent 100%);
      -webkit-mask-image: linear-gradient(to right, #000 60%, transparent 100%);
    }

    /* 2FA */
    .twofa-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .twofa-code {
      flex: 1;
      text-align: center;
      font-family: 'Orbitron', monospace;
      font-size: 20px;
      font-weight: 900;
      color: #00ffff;
      text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
      letter-spacing: 3px;
    }

    .twofa-countdown {
      font-family: 'Orbitron', sans-serif;
      font-size: 12px;
      color: #ff0080;
      font-weight: 700;
      min-width: 20px;
    }

    .twofa-btn {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 12px;
    }

    .twofa-input-row {
      display: flex;
      gap: 4px;
      margin-top: 6px;
    }

    .twofa-input-row input {
      flex: 1;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(128, 0, 255, 0.3);
      border-radius: 6px;
      padding: 6px 8px;
      color: #fff;
      font-size: 10px;
    }

    .twofa-input-row button {
      padding: 6px 12px;
      border-radius: 6px;
      background: linear-gradient(135deg, #ff0080, #7b2ff7);
      border: none;
      color: #fff;
      font-weight: 700;
      font-size: 10px;
      cursor: pointer;
    }

    /* Button Grid */
    .btn-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .btn {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      color: #fff;
      cursor: pointer;
      border: none;
      transition: all 0.15s;
      position: relative;
      overflow: hidden;
    }

    .btn:active {
      transform: scale(0.95);
    }

    .btn::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.2), transparent);
      opacity: 0;
      transition: opacity 0.2s;
    }

    .btn:hover::after { opacity: 1; }

    .save-btn {
      width: 100%;
      padding: 8px;
      border-radius: 8px;
      background: linear-gradient(135deg, #00c853, #00e676);
      border: none;
      color: #fff;
      font-weight: 700;
      font-size: 11px;
      cursor: pointer;
      margin-top: 6px;
    }

    /* Daisy */
    .daisy-phone {
      background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(0, 128, 255, 0.1));
      border: 2px solid #00ffff;
      border-radius: 10px;
      padding: 12px;
      text-align: center;
      font-family: 'Orbitron', monospace;
      font-size: 14px;
      font-weight: 700;
      color: #00ffff;
      cursor: pointer;
      margin-bottom: 8px;
    }

    .daisy-btns {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    .daisy-btns button {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      border: none;
      font-weight: 700;
      font-size: 12px;
      cursor: pointer;
    }

    .daisy-wait {
      background: rgba(255, 0, 0, 0.1);
      border: 2px dashed #ff0080;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      color: #ff0080;
      font-weight: 700;
      display: none;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }

    .daisy-code {
      background: linear-gradient(135deg, rgba(0, 255, 0, 0.1), rgba(0, 200, 0, 0.1));
      border: 3px solid #0f0;
      border-radius: 10px;
      padding: 14px;
      text-align: center;
      font-family: 'Orbitron', monospace;
      font-size: 28px;
      font-weight: 900;
      color: #0f0;
      text-shadow: 0 0 20px rgba(0, 255, 0, 0.8);
      cursor: pointer;
      display: none;
      margin-bottom: 8px;
    }

    .daisy-log {
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid #333;
      border-radius: 6px;
      padding: 6px;
      font-family: monospace;
      font-size: 8px;
      color: #0a0;
      height: 50px;
      overflow-y: auto;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.9);
      border: 1px solid #ff0080;
      color: #00ffff;
      padding: 10px 20px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      opacity: 0;
      transition: opacity 0.2s;
      z-index: 9999;
      box-shadow: 0 0 20px rgba(255, 0, 128, 0.4);
    }

    .toast.show { opacity: 1; }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: 9999;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: linear-gradient(135deg, #150634, #1a0a2e);
      border: 1px solid #ff0080;
      border-radius: 16px;
      padding: 16px;
      width: 90%;
      max-width: 350px;
      max-height: 70vh;
      overflow-y: auto;
    }

    .modal h3 {
      font-family: 'Orbitron', sans-serif;
      color: #ff0080;
      text-align: center;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .modal .close {
      float: right;
      font-size: 24px;
      cursor: pointer;
      color: #888;
    }

    #profileList {
      list-style: none;
    }

    #profileList li {
      padding: 10px;
      margin: 6px 0;
      background: rgba(255, 0, 128, 0.1);
      border: 1px solid rgba(255, 0, 128, 0.3);
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }

    #profileList li:hover {
      background: rgba(255, 0, 128, 0.2);
      transform: translateX(5px);
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #ff0080; border-radius: 4px; }
  </style>
</head>
<body>

  <!-- Header -->
  <div class="header">
    <div class="header-left">
      <button class="back-btn" id="backBtn" onclick="goBack()">‚Üê</button>
      <div>
        <div class="header-title" id="headerTitle">‚ö° TOOLS</div>
        <div class="header-profile" id="headerProfile">‚Äî</div>
      </div>
    </div>
    <div class="header-right">
      <div class="ip-box" id="ipBox">...</div>
      <button class="rotate-btn" id="rotateBtn" onclick="rotateIP()">üîÑ</button>
    </div>
  </div>

  <!-- Main -->
  <div class="main">

    <!-- Menu -->
    <div class="view active" id="menuView">
      <div class="menu">
        <div class="menu-item" onclick="showView('instaView')">
          <div class="menu-icon insta">üì∏</div>
          <div class="menu-text">
            <div class="menu-title">Setup Insta</div>
            <div class="menu-sub">Profile ‚Ä¢ 2FA ‚Ä¢ Login ‚Ä¢ Tools</div>
          </div>
          <div class="menu-arrow">‚Ä∫</div>
        </div>
        <div class="menu-item" onclick="showView('threadsView')">
          <div class="menu-icon threads">üßµ</div>
          <div class="menu-text">
            <div class="menu-title">Setup Threads</div>
            <div class="menu-sub">Profile ‚Ä¢ 2FA ‚Ä¢ Login</div>
          </div>
          <div class="menu-arrow">‚Ä∫</div>
        </div>
        <div class="menu-item" onclick="showView('daisyView')">
          <div class="menu-icon daisy">üì±</div>
          <div class="menu-text">
            <div class="menu-title">Daisy SMS</div>
            <div class="menu-sub">Phone Rental Service</div>
          </div>
          <div class="menu-arrow">‚Ä∫</div>
        </div>
      </div>
    </div>

    <!-- Insta View -->
    <div class="view" id="instaView">
      <!-- Profile -->
      <div class="card">
        <div class="card-title">üë§ Profile</div>
        <div class="profile-grid">
          <div class="field"><label>Container</label><span id="i_name" onclick="copyThis(this)">‚Äî</span></div>
          <div class="field"><label>Username</label><input id="i_user" value="‚Äî"/></div>
          <div class="field fade"><label>2FA</label><span id="i_2fa" onclick="copyThis(this)">‚Äî</span></div>
          <div class="field"><label>Pass</label><span id="i_pass" onclick="copyThis(this)">‚Äî</span></div>
        </div>
        <button class="save-btn" onclick="saveProfile()">üíæ SAVE</button>
      </div>

      <!-- 2FA -->
      <div class="card">
        <div class="card-title">üîê 2FA Code</div>
        <div class="twofa-row">
          <div class="twofa-countdown" id="i_cd">--</div>
          <div class="twofa-code" id="i_totp">------</div>
          <button class="twofa-btn" style="background:#6c5ce7" onclick="pasteSecret()">üìã</button>
          <button class="twofa-btn" style="background:#00cec9" onclick="copyTotp()">üìÑ</button>
        </div>
        <div class="twofa-input-row">
          <input id="i_secret" placeholder="Enter 2FA secret..."/>
          <button onclick="send2FA()">SEND</button>
        </div>
      </div>

      <!-- Nav -->
      <div class="card">
        <div class="card-title">üß≠ Navigation</div>
        <div class="btn-grid">
          <button class="btn" style="background:#333" onclick="nextProfile()">=</button>
          <button class="btn" style="background:#444" onclick="runCont();nextProfile()">Nx</button>
          <button class="btn" style="background:#333" onclick="prevProfile()">Pv</button>
          <button class="btn" style="background:#ff8f00" onclick="firstProfile()">ü•á</button>
          <button class="btn" style="background:#43a047" onclick="showProfileList()">üìÇ</button>
          <button class="btn" style="background:#e91e63" onclick="loadProfiles()">üîÑ</button>
        </div>
      </div>

      <!-- IG Login -->
      <div class="card">
        <div class="card-title">üîë IG Login</div>
        <div class="btn-grid">
          <button class="btn" style="background:linear-gradient(135deg,#8e24aa,#e91e63)" onclick="twoFA()">2FA</button>
          <button class="btn" style="background:linear-gradient(135deg,#e91e63,#6a1b9a)" onclick="copyPass();openIG()">üóùÔ∏è</button>
          <button class="btn" style="background:linear-gradient(135deg,#8e24aa,#ff0080)" onclick="copy2FA()">Au</button>
          <button class="btn" style="background:linear-gradient(135deg,#ffb300,#6a1b9a)" onclick="copyUser();openIG()">Un</button>
          <button class="btn" style="background:linear-gradient(135deg,#f44336,#ffb300)" onclick="copyName();openIG()">Na</button>
          <button class="btn" style="background:linear-gradient(135deg,#8e24aa,#e91e63)" onclick="copyUser();Createcon()">‚úçÔ∏è</button>
        </div>
      </div>

      <!-- For IG -->
      <div class="card">
        <div class="card-title">‚ú® For IG</div>
        <div class="btn-grid">
          <button class="btn" style="background:linear-gradient(135deg,#3949ab,#1e88e5)" onclick="randomCeleb()">üé≤</button>
          <button class="btn" style="background:linear-gradient(135deg,#8e24aa,#e91e63)" onclick="randomBio();IGedit()">üå∏</button>
          <button class="btn" style="background:linear-gradient(135deg,#00897b,#26a69a)" onclick="randomCaption();openIG()">üìù</button>
        </div>
      </div>
    </div>

    <!-- Threads View -->
    <div class="view" id="threadsView">
      <!-- Profile -->
      <div class="card">
        <div class="card-title">üë§ Profile</div>
        <div class="profile-grid">
          <div class="field"><label>Container</label><span id="t_name" onclick="copyThis(this)">‚Äî</span></div>
          <div class="field"><label>Username</label><input id="t_user" value="‚Äî"/></div>
          <div class="field fade"><label>2FA</label><span id="t_2fa" onclick="copyThis(this)">‚Äî</span></div>
          <div class="field"><label>Pass</label><span id="t_pass" onclick="copyThis(this)">‚Äî</span></div>
        </div>
        <button class="save-btn" onclick="saveProfile()">üíæ SAVE</button>
      </div>

      <!-- 2FA -->
      <div class="card">
        <div class="card-title">üîê 2FA Code</div>
        <div class="twofa-row">
          <div class="twofa-countdown" id="t_cd">--</div>
          <div class="twofa-code" id="t_totp">------</div>
          <button class="twofa-btn" style="background:#6c5ce7" onclick="pasteSecret()">üìã</button>
          <button class="twofa-btn" style="background:#00cec9" onclick="copyTotp()">üìÑ</button>
        </div>
        <div class="twofa-input-row">
          <input id="t_secret" placeholder="Enter 2FA secret..."/>
          <button onclick="send2FA()">SEND</button>
        </div>
      </div>

      <!-- Nav -->
      <div class="card">
        <div class="card-title">üß≠ Navigation</div>
        <div class="btn-grid">
          <button class="btn" style="background:#333" onclick="nextProfile()">=</button>
          <button class="btn" style="background:#444" onclick="runCont();nextProfile()">Nx</button>
          <button class="btn" style="background:#333" onclick="prevProfile()">Pv</button>
          <button class="btn" style="background:#ff8f00" onclick="firstProfile()">ü•á</button>
          <button class="btn" style="background:#43a047" onclick="showProfileList()">üìÇ</button>
          <button class="btn" style="background:#e91e63" onclick="loadProfiles()">üîÑ</button>
        </div>
      </div>

      <!-- Threads Login -->
      <div class="card">
        <div class="card-title">üîë Threads Login</div>
        <div class="btn-grid">
          <button class="btn" style="background:#4caf50" onclick="copyRandom();openTH()">‚ô≥</button>
          <button class="btn" style="background:#4caf50" onclick="copyUser();runCreateTH()">‚úçÔ∏è</button>
          <button class="btn" style="background:#ff9800" onclick="copyUser();openTH()">Un</button>
          <button class="btn" style="background:#00acc1" onclick="copyPass();openTH()">üóùÔ∏è</button>
        </div>
      </div>
    </div>

    <!-- Daisy View -->
    <div class="view" id="daisyView">
      <div class="card" style="flex:1;display:flex;flex-direction:column;">
        <div class="card-title">üì± Phone Rental</div>
        <div class="daisy-phone" id="dPhone" onclick="copyPhone()">Tap RENT to get number</div>
        <div class="daisy-btns">
          <button style="background:#28a745" onclick="getBalance()">‚úîÔ∏è BAL</button>
          <button style="background:#007bff" onclick="rentNumber()">üîë RENT</button>
          <button style="background:#dc3545" onclick="cancelNumber()">‚ùå END</button>
        </div>
        <div class="daisy-wait" id="dWait">‚è≥ Waiting for code...</div>
        <div class="daisy-code" id="dCode" onclick="copyCode()">000000</div>
        <div class="daisy-log" id="dLog" style="flex:1;"></div>
      </div>
    </div>

  </div>

  <div class="toast" id="toast"></div>

  <div class="modal" id="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">√ó</span>
      <h3>Select Profile</h3>
      <ul id="profileList"></ul>
    </div>
  </div>

  <script>
    // State
    let profiles=[], idx=0, currentView='menuView', isRotating=false, lastIP='';
    const celebs=["Selena Gomez","Kylie Jenner","Dwayne Johnson","Ariana Grande","Kim Kardashian","Beyonc√©","Taylor Swift","Jennifer Lopez","Nicki Minaj","Miley Cyrus","Katy Perry","Zendaya","Cardi B","Billie Eilish","Olivia Rodrigo","Doja Cat","Lil Nas X","Travis Scott","Post Malone","Rihanna","Justin Bieber","Drake","Lana Del Rey","Halsey","Harry Styles","Dua Lipa","Bad Bunny","Shakira"];
    let remainingCelebs=[...celebs];
    const API="https://script.google.com/macros/s/AKfycbwF2WtipPSpJIt29ED00NbBWlfrYUJk-yUy5-IiyNSlUXIeoKLWqd6SYigSXX0wmt0v/exec";

    // Navigation
    function showView(id){
      document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      currentView=id;
      const b=document.getElementById('backBtn');
      const t=document.getElementById('headerTitle');
      if(id==='menuView'){b.classList.remove('visible');t.textContent='‚ö° TOOLS';}
      else{b.classList.add('visible');t.textContent=id==='instaView'?'üì∏ INSTA':id==='threadsView'?'üßµ THREADS':'üì± DAISY';}
    }
    function goBack(){showView('menuView');}

    // Profiles
    async function loadProfiles(){
      try{
        const r=await fetch(API);
        profiles=await r.json();
        idx=parseInt(localStorage.getItem('idx')||'0');
        if(idx>=profiles.length)idx=0;
        display();
        toast('Loaded!');
      }catch(e){toast('Load failed');}
    }

    function display(){
      if(!profiles.length)return;
      const p=profiles[idx];
      ['i','t'].forEach(x=>{
        document.getElementById(x+'_name').textContent=p.name||'‚Äî';
        document.getElementById(x+'_user').value=p.username||'‚Äî';
        document.getElementById(x+'_2fa').textContent=p.twofa||'‚Äî';
        document.getElementById(x+'_pass').textContent=p.password||'‚Äî';
        document.getElementById(x+'_secret').value=p.twofa?.trim()||'';
      });
      document.getElementById('headerProfile').textContent=p.username||'‚Äî';
      localStorage.setItem('idx',idx);
      updateTotp();
    }

    async function saveProfile(){
      const p=profiles[idx];
      if(!p)return toast('No profile');
      const newUser=currentView==='threadsView'?document.getElementById('t_user').value.trim():document.getElementById('i_user').value.trim();
      if(!newUser||newUser==='‚Äî')return toast('Invalid username');
      try{
        const r=await fetch(API,{method:'POST',headers:{'Content-Type':'text/plain'},body:JSON.stringify({oldusername:p.username,newUsername:newUser})});
        const res=await r.json();
        if(res.success){toast('Saved!');p.username=newUser;display();}
        else toast('Failed: '+res.message);
      }catch(e){toast('Network error');}
    }

    function prevProfile(){if(idx>0){idx--;display();}}
    function nextProfile(){if(idx<profiles.length-1){idx++;display();}}
    function firstProfile(){idx=0;display();toast('First');}

    function showProfileList(){
      const ul=document.getElementById('profileList');
      ul.innerHTML='';
      profiles.forEach((p,i)=>{
        const li=document.createElement('li');
        li.textContent=[p.name,p.username].filter(Boolean).join(' ')||'Profile '+(i+1);
        li.onclick=()=>{idx=i;display();closeModal();};
        ul.appendChild(li);
      });
      document.getElementById('modal').style.display='flex';
    }
    function closeModal(){document.getElementById('modal').style.display='none';}
    window.onclick=e=>{if(e.target===document.getElementById('modal'))closeModal();};

    // 2FA
    function b32(s){
      s=(s||'').replace(/=+$/,'').replace(/[^A-Z2-7]/gi,'').toUpperCase();
      const a='ABCDEFGHIJKLMNOPQRSTUVWXYZ234567';
      let b=0,v=0,r=[];
      for(let i=0;i<s.length;i++){const x=a.indexOf(s[i]);if(x===-1)continue;v=(v<<5)|x;b+=5;if(b>=8){b-=8;r.push((v>>b)&0xFF);}}
      return new Uint8Array(r);
    }
    function ctr(c){const b=new ArrayBuffer(8),v=new DataView(b);v.setUint32(0,Math.floor(c/2**32));v.setUint32(4,c>>>0);return b;}
    async function hmac(k,c){const key=await crypto.subtle.importKey('raw',k,{name:'HMAC',hash:'SHA-1'},false,['sign']);return new Uint8Array(await crypto.subtle.sign('HMAC',key,c));}
    function trunc(h,d){const o=h[h.length-1]&0x0f,c=((h[o]&0x7f)<<24)|((h[o+1]&0xff)<<16)|((h[o+2]&0xff)<<8)|(h[o+3]&0xff);return(c%10**d).toString().padStart(d,'0');}
    async function totp(s){const k=b32(s);if(!k.length)return null;return trunc(await hmac(k,ctr(Math.floor(Date.now()/1000/30))),6);}

    async function updateTotp(){
      const rem=30-(Math.floor(Date.now()/1000)%30);
      for(const x of['i','t']){
        document.getElementById(x+'_cd').textContent=rem;
        const s=document.getElementById(x+'_secret').value.trim();
        document.getElementById(x+'_totp').textContent=s?(await totp(s)||'invalid'):'------';
      }
    }
    setInterval(updateTotp,1000);

    async function pasteSecret(){
      try{
        const t=await navigator.clipboard.readText();
        const x=currentView==='threadsView'?'t':'i';
        document.getElementById(x+'_secret').value=t.trim();
        updateTotp();toast('Pasted!');
      }catch(e){toast('Paste blocked');}
    }

    async function copyTotp(){
      const x=currentView==='threadsView'?'t':'i';
      const c=document.getElementById(x+'_totp').textContent;
      if(c&&c!=='------'&&c!=='invalid'){await navigator.clipboard.writeText(c);toast('Code copied!');}
    }

    async function send2FA(){
      const x=currentView==='threadsView'?'t':'i';
      const secret=document.getElementById(x+'_secret').value.trim();
      if(!secret)return toast('No secret');
      const p=profiles[idx];
      if(!p)return toast('No profile');
      if(p.twofa&&!confirm('Overwrite existing 2FA?'))return;
      try{
        const r=await fetch(API,{method:'POST',headers:{'Content-Type':'text/plain'},body:JSON.stringify({oldusername:p.username,new2fa:secret})});
        const res=await r.json();
        if(res.success){toast('2FA saved!');p.twofa=secret;display();}
        else toast('Failed');
      }catch(e){toast('Network error');}
    }

    // Copy helpers
    function copyThis(el){const t=el.textContent.trim();if(t&&t!=='‚Äî'){navigator.clipboard.writeText(t);toast('Copied!');}}
    function copyUser(){const p=profiles[idx];if(p?.username){navigator.clipboard.writeText(p.username);toast('Username copied!');}}
    function copyPass(){const p=profiles[idx];if(p?.password){navigator.clipboard.writeText(p.password);toast('Password copied!');}}
    function copy2FA(){const p=profiles[idx];if(p?.twofa){navigator.clipboard.writeText(p.twofa);toast('2FA copied!');}}
    function copyName(){const p=profiles[idx];if(p?.name){navigator.clipboard.writeText(p.name);toast('Name copied!');}}

    // Actions
    function openIG(){window.open('https://instagram.com/','_blank');}
    function openTH(){window.open('https://threads.net/','_blank');}
    function IGedit(){const u=profiles[idx]?.username;if(u)window.open(`instagram://user?username=${u}`,'_blank');else window.open('https://www.instagram.com/accounts/edit/','_blank');}
    function twoFA(){window.open('https://accountscenter.instagram.com/password_and_security/two_factor/','_blank');}
    function Createcon(){window.location.href='shortcuts://run-shortcut?name=CreateIGCon';}
    function runCreateTH(){window.location.href='shortcuts://run-shortcut?name=CreateTh';}
    function runCont(){window.location.href='shortcuts://run-shortcut?name=NextIGTH';}

    function randomCeleb(){
      if(!remainingCelebs.length){remainingCelebs=[...celebs];toast('List reset!');}
      const i=Math.floor(Math.random()*remainingCelebs.length);
      const c=remainingCelebs.splice(i,1)[0];
      navigator.clipboard.writeText(c);
      window.open('https://www.instagram.com/explore/search/keyword/?q='+encodeURIComponent(c),'_blank');
      toast(`${c} (${remainingCelebs.length} left)`);
    }

    function randomBio(){
      const e=['üíñ','üíï','üå∏','‚ú®','üå∑','üíÖ','üëë','üíì','ü¶ã','üíú'];
      navigator.clipboard.writeText(`18 ${e[Math.floor(Math.random()*e.length)]}\nSingle ${e[Math.floor(Math.random()*e.length)]}`);
      toast('Bio copied!');
    }

    function randomCaption(){
      const c=['no reason, just liked these','this light felt kinda nice','felt cute, might delete later','vibes','golden hour','soft girl era','main character energy','just a girl','healing era','doing it for me'];
      navigator.clipboard.writeText(c[Math.floor(Math.random()*c.length)]);
      toast('Caption copied!');
    }

    function copyRandom(){
      const t=['First post: I NEED FRIENDS!!','Wanna meet older guys','First post Trying to make friends on Threads.'];
      navigator.clipboard.writeText(t[Math.floor(Math.random()*t.length)]);
      toast('Copied!');
    }

    // IP
    async function getIP(){try{return(await(await fetch('https://api.ipify.org?format=json')).json()).ip;}catch(e){return'error';}}
    async function triggerRotate(){try{await fetch('https://i.fxdx.in/actionlinks/do/changeip/YTbojipTQnuowNvn2MkNoA');return true;}catch(e){return false;}}

    async function rotateIP(){
      if(isRotating){isRotating=false;toast('Stopped');document.getElementById('rotateBtn').classList.remove('rotating');return;}
      const box=document.getElementById('ipBox'),btn=document.getElementById('rotateBtn');
      const oldIP=box.textContent;
      box.textContent='...';box.className='ip-box loading';btn.classList.add('rotating');
      isRotating=true;let att=0;
      const loop=async()=>{
        att++;box.textContent='#'+att;toast('Attempt '+att);
        await triggerRotate();await new Promise(r=>setTimeout(r,3000));
        const newIP=await getIP();
        if(newIP!==oldIP&&oldIP!=='...'&&newIP!=='error'){
          box.textContent=newIP;box.className='ip-box success';btn.classList.remove('rotating');
          toast('SUCCESS: '+newIP);isRotating=false;lastIP=newIP;
          setTimeout(()=>box.className='ip-box',5000);
        }else if(att<20&&isRotating){setTimeout(loop,1000);}
        else{toast('Max attempts');btn.classList.remove('rotating');isRotating=false;box.textContent=newIP;box.className='ip-box';}
      };
      loop();
    }

    // Daisy
    const DAPI='https://daisysms.com/stubs/handler_api.php',DKEY='G1wJwY6tehQmO7uiX3v7nCTSZrU3oc';
    const P=u=>`https://corsproxy.io/?${encodeURIComponent(u)}`;
    let rental=null,phone=null,poll=null;

    function dlog(t){const l=document.getElementById('dLog');l.innerHTML+=t+'<br>';l.scrollTop=9999;}

    async function dapi(a,p={}){
      let u=`${DAPI}?api_key=${DKEY}&action=${a}`;
      for(let k in p)u+=`&${k}=${p[k]}`;
      try{const r=await fetch(P(u));return{body:(await r.text()).trim()};}catch(e){dlog('Error: '+e.message);throw e;}
    }

    async function getBalance(){
      try{const{body}=await dapi('getBalance');if(body.startsWith('ACCESS_BALANCE:')){const b=body.split(':')[1];dlog('Balance: '+b);toast('Balance: '+b);}else{dlog(body);toast('Failed');}}catch(e){toast('Error');}
    }

    async function rentNumber(){
      if(poll){clearInterval(poll);poll=null;}
      rental=null;phone=null;
      document.getElementById('dCode').style.display='none';
      document.getElementById('dWait').style.display='none';
      try{
        const{body}=await dapi('getNumber',{service:'ig',max_price:'0.8'});
        if(body.startsWith('ACCESS_NUMBER:')){
          const[_,id,num]=body.split(':');
          rental=id;phone=num;
          document.getElementById('dPhone').textContent=num;
          document.getElementById('dWait').style.display='block';
          dlog('Rented: '+num);toast('Rented: '+num);
          startPoll();
        }else{document.getElementById('dPhone').textContent='Failed';dlog(body);toast(body);}
      }catch(e){toast('Error');}
    }

    async function checkCode(){
      if(!rental)return;
      try{
        const{body}=await dapi('getStatus',{id:rental,text:1});
        dlog('Status: '+body);
        if(body.includes('STATUS_OK')||body.includes('OK')){
          const m=body.match(/(\d{4,8})/);
          if(m){
            document.getElementById('dCode').textContent=m[1];
            document.getElementById('dCode').style.display='block';
            document.getElementById('dWait').style.display='none';
            dlog('CODE: '+m[1]);toast('Code: '+m[1]);
            clearInterval(poll);poll=null;
          }
        }
      }catch(e){dlog('Error');}
    }

    function startPoll(){
      if(poll)clearInterval(poll);
      poll=setInterval(checkCode,3000);checkCode();
      setTimeout(()=>{if(poll){clearInterval(poll);poll=null;dlog('Timeout');toast('Timeout');}},300000);
    }

    function copyPhone(){if(phone){navigator.clipboard.writeText(phone);toast('Phone copied!');}}
    function copyCode(){const c=document.getElementById('dCode').textContent;navigator.clipboard.writeText(c);toast('Code copied!');}

    async function cancelNumber(){
      if(!rental)return toast('No rental');
      try{
        const{body}=await dapi('setStatus',{id:rental,status:8});
        if(body.includes('ACCESS_CANCEL')){
          dlog('Canceled');toast('Canceled');
          document.getElementById('dPhone').textContent='Tap RENT to get number';
          document.getElementById('dWait').style.display='none';
          document.getElementById('dCode').style.display='none';
          if(poll){clearInterval(poll);poll=null;}
          rental=null;phone=null;
        }else{dlog(body);toast('Failed');}
      }catch(e){toast('Error');}
    }

    // Toast
    function toast(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),1500);}

    // Init
    async function init(){
      await loadProfiles();
      const ip=await getIP();
      document.getElementById('ipBox').textContent=ip;lastIP=ip;
      getBalance();
    }
    init();
  </script>
</body>
</html>
