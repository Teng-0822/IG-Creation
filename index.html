<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Profile Viewer</title>
<style>
  html, body { height: 100%; margin: 0; overflow: hidden; font-family: Arial, sans-serif; background: linear-gradient(135deg, #a8edea, #fed6e3); display: flex; justify-content: center; align-items: center; }
  .container { background: #fff; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); padding: 20px; width: 100%; max-width: 400px; }
  h3 { text-align: center; margin-bottom: 20px; }
  .field { margin: 8px 0; display: flex; align-items: center; }
  .field label { font-weight: bold; margin-right: 6px; white-space: nowrap; }
  .field span { flex: 1; font-size: 15px; }
  .actions { margin-top: 15px; text-align: center; }
  button { margin: 5px; padding: 10px 14px; border: none; border-radius: 10px; cursor: pointer; font-size: 14px; transition: 0.3s; }
  .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 10px 16px; border-radius: 8px; font-size: 14px; opacity: 0; transition: opacity 0.3s ease; }
  .toast.show { opacity: 1; }
  .floating-btn { position: fixed; bottom: 20px; width: 50px; height: 50px; display: flex; justify-content: center; align-items: center; border-radius: 50%; font-size: 22px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); color: white; }
  .floating-Next { right: 140px; background: #3f51b5; }
  .floating-Prev { right: 200px; background: #3f51b5; }
  .floating-IGP { right: 20px; background: #e1306c; }
  .floating-TOTPCopy { right: 80px; background: #009688; }

  .row { margin: 12px 0; }
  .code-box { display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px; }
  .code { font-size: 36px; font-weight: bold; letter-spacing: 4px; }
  .small { font-size: 12px; color: #666; margin-top: 5px; text-align:center; }
</style>
</head>
<body>

<div class="container">
  <h3>Profile</h3>
  <div class="field"><label>Name:</label><span id="name"></span></div>
  <div class="field"><label>Username:</label><span id="oldusername"></span></div>
  <div class="field"><label>Authenticator:</label><span id="newusername"></span></div>
  <div class="field"><label>Password:</label><span id="password"></span></div>

  <!-- Two-factor -->
  <div class="row">
    <input id="secret" placeholder="Enter Base32 Secret" style="width:100%" />
  </div>
  <div class="code-box">
    <button id="pasteBtn">Paste</button>
    <div id="totp" class="code">------</div>
    <button id="copyBtn">Copy</button>
  </div>
  <div class="small">Next update in <span id="countdown">â€”</span>s</div>
</div>

<!-- Floating buttons -->
<div class="floating-btn floating-Next" onclick="nextProfile()">Nx</div>
<div class="floating-btn floating-Prev" onclick="prevProfile()">Pv</div>
<div class="floating-btn floating-IGP" onclick="copyText('password'); openCurrentIG()">IGP</div>
<div class="floating-btn floating-TOTPCopy" onclick="copyText('totp')">TOTP</div>

<div id="toast" class="toast"></div>

<script>
const apiUrl = "https://script.google.com/macros/s/AKfycbwGm4ouDR7CNIhDhdosW8oCIn_apcAm_PBiDoDCyKJp_6Ogg3gvZYM2CTK0Zg2xASP1gQ/exec";
let profiles = [], currentIndex = 0;

async function loadProfiles() {
  const res = await fetch(apiUrl);
  profiles = await res.json();
  currentIndex = parseInt(localStorage.getItem("currentIndex") || 0);
  if(currentIndex >= profiles.length) currentIndex = 0; // safety
  displayProfile();
}

function displayProfile() {
  if(profiles.length === 0) return;
  const p = profiles[currentIndex];
  ["name","oldusername","newusername","password"].forEach(f => {
    document.getElementById(f).textContent = p[f] || "";
  });
  localStorage.setItem("currentIndex", currentIndex);
}

function prevProfile(){ if(currentIndex>0){ currentIndex--; displayProfile(); } }
function nextProfile(){ if(currentIndex<profiles.length-1){ currentIndex++; displayProfile(); } }

function openCurrentIG() { window.open(`https://Instagram.com/`, "_blank"); }

function copyText(field){
  const el = document.getElementById(field);
  if(!el) return;
  navigator.clipboard.writeText(el.textContent || el.value || "");
  showToast(field+" copied!");
}

function showToast(msg){
  const t=document.getElementById("toast");
  t.textContent=msg; t.classList.add("show");
  setTimeout(()=>{ t.classList.remove("show"); },1200);
}

// Two-factor functions
function base32toBytes(base32) {
  base32 = (base32||'').replace(/=+$/,'').replace(/[^A-Z2-7]/gi,'').toUpperCase();
  const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";
  let bits = 0, value = 0, bytes = [];
  for(let i=0;i<base32.length;i++){
    const idx = alphabet.indexOf(base32[i]);
    if(idx===-1) continue;
    value = (value<<5)|idx; bits+=5;
    if(bits>=8){ bits-=8; bytes.push((value>>bits)&0xFF); }
  }
  return new Uint8Array(bytes);
}
function counterToBuffer(counter) { const buf=new ArrayBuffer(8); const view=new DataView(buf); view.setUint32(0, Math.floor(counter/2**32)); view.setUint32(4, counter>>>0); return buf; }
async function hmacSha1(keyBytes, counterBuf) { const cryptoKey=await crypto.subtle.importKey('raw', keyBytes,{ name:'HMAC', hash:'SHA-1'},false,['sign']); const sig=await crypto.subtle.sign('HMAC', cryptoKey, counterBuf); return new Uint8Array(sig); }
function truncate(hmacBytes,digits){ const offset=hmacBytes[hmacBytes.length-1]&0x0f; const code=((hmacBytes[offset]&0x7f)<<24)|((hmacBytes[offset+1]&0xff)<<16)|((hmacBytes[offset+2]&0xff)<<8)|(hmacBytes[offset+3]&0xff); return (code%10**digits).toString().padStart(digits,'0'); }
async function generateTOTP(secret){ const keyBytes=base32toBytes(secret); if(!keyBytes.length) return null; const counter=Math.floor(Date.now()/1000/30); const hmac=await hmacSha1(keyBytes,counterToBuffer(counter)); return truncate(hmac,6); }

const secretEl=document.getElementById('secret'), codeEl=document.getElementById('totp'), countdownEl=document.getElementById('countdown'), copyBtn=document.getElementById('copyBtn');

async function updateTOTP() {
  const secret = secretEl.value.trim();
  const period = 30;
  const now = Math.floor(Date.now()/1000);
  const remaining = period - (now % period);
  countdownEl.textContent = remaining;
  if(!secret){ codeEl.textContent = "------"; return; }
  const code = await generateTOTP(secret);
  codeEl.textContent = code || "invalid";
}

setInterval(updateTOTP, 1000);
updateTOTP();

copyBtn.addEventListener('click', async () => {
  const code = codeEl.textContent.trim();
  if(code && code!=="------" && code!=="invalid"){ await navigator.clipboard.writeText(code); copyBtn.textContent="Copied!"; setTimeout(()=>copyBtn.textContent="Copy",1200);}
});

document.getElementById('pasteBtn').addEventListener('click', async ()=>{
  try{ const text=await navigator.clipboard.readText(); if(text) secretEl.value=text.trim(); } catch(e){ alert("Clipboard paste not allowed by browser."); }
});

loadProfiles();
</script>
</body>
</html>
