<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile Viewer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #a8edea, #fed6e3);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 10px;
    }
    .container {
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      padding: 20px;
      width: 100%;
      max-width: 400px;
    }
    h2 { text-align: center; margin-bottom: 20px; }

    .field {
      margin: 8px 0;
      display: flex;
      align-items: center;
    }
    .field label {
      font-weight: bold;
      margin-right: 6px;
      white-space: nowrap;
    }
    .field span,
    .field input {
      flex: 1;
      font-size: 15px;
    }
    .field input {
      padding: 4px;
      border-radius: 6px;
      border: 1px solid #ccc;
      display: none;
    }
    .edit-btn { 
      background: #ffc107; 
      color: #000; 
      font-size: 12px; 
      padding: 4px 6px; 
      margin-left: 5px;
      border-radius: 6px;
      cursor: pointer;
    }

    .actions, .copy-actions { margin-top: 15px; text-align: center; }
    button {
      margin: 5px;
      padding: 10px 14px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      transition: 0.3s;
    }
    .nav-btn { background: #007bff; color: #fff; }
    .copy-btn { background: #28a745; color: #fff; }
    .save-btn { background: #17a2b8; color: #fff; }
    .ig-btn { background: #e1306c; color: #fff; }

    .floating-refresh {
      position: fixed; bottom: 20px; right: 20px;
      background: #ff4081; color: white;
      border-radius: 50%; width: 50px; height: 50px;
      display: flex; justify-content: center; align-items: center;
      font-size: 24px; cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Profile</h2>

    <div class="field">
      <label>Name:</label>
      <span id="name"></span>
    </div>

    <div class="field">
      <label>Old Username:</label>
      <span id="oldusername"></span>
      <input id="oldusernameInput">
      <button class="edit-btn" onclick="toggleEdit('oldusername')">‚úèÔ∏è</button>
    </div>

    <div class="field">
      <label>New Username:</label>
      <span id="newusername"></span>
      <input id="newusernameInput">
      <button class="edit-btn" onclick="toggleEdit('newusername')">‚úèÔ∏è</button>
    </div>

    <div class="field">
      <label>Password:</label>
      <span id="password"></span>
    </div>

    <div class="field">
      <label>Birthdate:</label>
      <span id="birthdate"></span>
    </div>

    <div class="field">
      <label>ID:</label>
      <span id="id"></span>
    </div>

    <!-- Copy buttons grouped -->
    <div class="copy-actions">
      <button class="copy-btn" onclick="copyText('name')">Copy Name</button>
      <button class="copy-btn" onclick="copyText('oldusername')">Copy Old</button>
      <button class="copy-btn" onclick="copyText('newusername')">Copy New</button>
      <button class="copy-btn" onclick="copyText('password')">Copy Pass</button>
    </div>

    <!-- Action buttons -->
    <div class="actions">
      <button class="save-btn" onclick="saveEdits()">üíæ Save</button>
      <button class="ig-btn" onclick="openCurrentIG()">üì± IG</button><br>
      <button class="nav-btn" onclick="prevProfile()">‚èÆ Prev</button>
      <button class="nav-btn" onclick="nextProfile(); runNextContainer()">Next ‚è≠</button><br>
    </div>
  </div>

  <div class="floating-refresh" onclick="loadProfiles()">‚ü≥</div>

  <script>
    const apiUrl = "https://script.google.com/macros/s/AKfycbzjygQeEi6TqGQqssc9HgHBxBDG4ROEMnsRCef7y6NA0rZq3N7IMvn10oZdzHtZKfotlA/exec";
    let profiles = [], currentIndex = 0;

    async function loadProfiles() {
      const res = await fetch(apiUrl);
      profiles = await res.json();

      const savedIndex = localStorage.getItem("currentIndex");
      if (savedIndex !== null && savedIndex < profiles.length) {
        currentIndex = parseInt(savedIndex, 10);
      } else {
        currentIndex = 0;
      }

      displayProfile();
    }

    function displayProfile() {
      const p = profiles[currentIndex];
      ["name","oldusername","newusername","password","birthdate","id"].forEach(f=>{
        document.getElementById(f).textContent = p[f] || "";
        if(document.getElementById(f+"Input")) document.getElementById(f+"Input").style.display="none";
      });
      localStorage.setItem("currentIndex", currentIndex);
    }

    function prevProfile(){
      if(currentIndex > 0){ currentIndex--; displayProfile(); }
    }

    function nextProfile(){
      if(currentIndex < profiles.length - 1){ currentIndex++; displayProfile(); }
    }

    function runNextContainer(){
      window.location.href="shortcuts://run-shortcut?name=NextIG";
    }

    function copyText(field){
      const text=document.getElementById(field).textContent;
      navigator.clipboard.writeText(text);
      alert(field+" copied: "+text);
    }

    function toggleEdit(field){
      const span=document.getElementById(field);
      const input=document.getElementById(field+"Input");
      if(input.style.display==="none"){
        input.value=span.textContent;
        span.style.display="none";
        input.style.display="inline-block";
      } else {
        span.textContent=input.value;
        span.style.display="inline-block";
        input.style.display="none";
      }
    }

    async function saveEdits(){
      const p=profiles[currentIndex];
      const oldusername=document.getElementById("oldusernameInput").style.display!=="none"?document.getElementById("oldusernameInput").value:p.oldusername;
      const newusername=document.getElementById("newusernameInput").style.display!=="none"?document.getElementById("newusernameInput").value:p.newusername;

      const updated={ id:p.id, oldusername, newusername };
      const res=await fetch(apiUrl,{ method:"POST", body:JSON.stringify(updated), headers:{"Content-Type":"application/json"} });
      const result=await res.json();
      if(result.success){ alert("Saved!"); loadProfiles(); }
      else { alert("Error: "+result.message); }
    }

    function openCurrentIG(){
      const p=profiles[currentIndex];
      if(p && p.newusername){
        window.open(`https://instagram.com/${p.newusername}`,"_blank");
      }
    }

    loadProfiles();
  </script>
</body>
</html>
